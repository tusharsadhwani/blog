<!DOCTYPE html><html lang="en" class="astro-7CIAHWF2"><head>
    
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë®‚Äçüíª</text></svg>">

<!-- Primary Meta Tags -->
<title>The Comprehensive Guide to mypy</title>
<meta name="title" content="The Comprehensive Guide to mypy">
<meta name="description" content="A single article to teach you everything you need to know about Python's type checker.">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://sadh.life">
<meta property="og:title" content="The Comprehensive Guide to mypy">
<meta property="og:description" content="A single article to teach you everything you need to know about Python's type checker.">
<meta property="og:image" content="https://sadh.life/images/mypy.jpg">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://sadh.life">
<meta property="twitter:title" content="The Comprehensive Guide to mypy">
<meta property="twitter:description" content="A single article to teach you everything you need to know about Python's type checker.">
<meta property="twitter:image" content="https://sadh.life/images/mypy.jpg">

<link rel="stylesheet" href="/style/global.css">
<link rel="stylesheet" href="/style/merged-themes.css">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;600&amp;family=Open+Sans:wght@400;600&amp;display=swap">
  <link rel="stylesheet" href="../../assets/android-localhost.1e4f8e75.css">




<script type="module" src="../../assets/mypy-guide.d1c4b343.js"></script>
</head>
  

  <body id="top">
    <header class="astro-D64JDZG7">
  <a href="/" class="astro-D64JDZG7">
    <svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="400" height="400" version="1.1" class="astro-D64JDZG7">
      <g class="astro-D64JDZG7">
        <rect width="380" height="380" x="10" y="10" stroke="var(--text-color)" stroke-width="18" rx="18" fill-opacity="0" class="astro-D64JDZG7"></rect>
        <text x="52.5" y="357.427" font-family="sans-serif" font-size="250" font-weight="bold" text-anchor="start" transform="matrix(0.946786642074585,0,0,1.0035842657089233,19.687279514968395,-1.4603642597794533)" xml:space="preserve" style="stroke: var(--text-color); fill: var(--text-color)" class="astro-D64JDZG7">TS</text>
      </g>
    </svg>

  </a>
  <div class="right astro-D64JDZG7">
    <astro-root uid="rve9A"></astro-root>
  </div>
</header>



    <div class="layout astro-36S45FQT">
  <header class="astro-36S45FQT">
    <p class="publish-date astro-36S45FQT">Thursday, 6 May 2021</p>
    <h1 class="title astro-36S45FQT">The Comprehensive Guide to mypy</h1>
    <img src="/images/mypy.jpg" title="The Comprehensive Guide to mypy" alt="The Comprehensive Guide to mypy" class="astro-36S45FQT">
    
<div class="author astro-BL6UQIAR">
  <p class="astro-BL6UQIAR"><a href="https://tusharsadhwani.dev" class="astro-BL6UQIAR">@tusharsadhwani</a></p>
</div>

  </header>
  <article class="content astro-36S45FQT">
    <main class="astro-36S45FQT">
      <p><a href="https://github.com/python/mypy">Mypy</a> is a <strong>static type checker</strong> for Python. It acts as a linter, that allows you to write statically typed code, and verify the soundness of your types.</p><p>All mypy does is check your type hints. It's <strong>not like TypeScript</strong>, which needs to be compiled before it can work. <strong>All mypy code is valid Python, no compiler needed</strong>.</p><p>This gives us the advantage of having types, as you can know for certain that there is no type-mismatch in your code, just as you can in typed, compiled languages like C++ and Java, but you also get the benefit of being Python üêç‚ú® <em>(you also get other benefits like null safety!)</em></p><p>For a more detailed explanation on what are types useful for, head over to the blog I wrote previously: <a href="/post/does-python-need-types">Does Python need types?</a></p><p>This article is going to be a deep dive for anyone who wants to learn about mypy, and all of its capabilities.</p><blockquote>
<p><em>If you haven't noticed the article length, this is going to be long. So grab a cup of your favorite beverage, and let's get straight into it.</em></p>
</blockquote><h2 id="index">Index</h2><ul>
<li><a href="#index">Index</a></li>
<li><a href="#setting-up-mypy">Setting up mypy</a>
<ul>
<li><a href="#using-mypy-in-the-terminal">Using mypy in the terminal</a></li>
<li><a href="#using-mypy-in-vscode">Using mypy in VSCode</a></li>
</ul>
</li>
<li><a href="#primitive-types">Primitive types</a></li>
<li><a href="#collection-types">Collection types</a></li>
<li><a href="#type-debugging---part-1">Type debugging - Part 1</a></li>
<li><a href="#union-and-optional">Union and Optional</a></li>
<li><a href="#any-type">Any type</a></li>
<li><a href="#miscellaneous-types">Miscellaneous types</a>
<ul>
<li><a href="#tuple">Tuple</a></li>
<li><a href="#typeddict">TypedDict</a></li>
<li><a href="#literal">Literal</a></li>
<li><a href="#final">Final</a></li>
<li><a href="#noreturn">NoReturn</a></li>
</ul>
</li>
<li><a href="#typing-classes">Typing classes</a></li>
<li><a href="#typing-namedtuples">Typing namedtuples</a></li>
<li><a href="#typing-decorators">Typing decorators</a></li>
<li><a href="#typing-generators">Typing generators</a></li>
<li><a href="#typing-args-and-kwargs">Typing <code data-astro-raw="">*args</code> and <code data-astro-raw="">**kwargs</code></a></li>
<li><a href="#duck-types">Duck types</a></li>
<li><a href="#function-overloading-with-overload">Function overloading with <code data-astro-raw="">@overload</code></a></li>
<li><a href="#type-type"><code data-astro-raw="">Type</code> type</a></li>
<li><a href="#typing-pre-existing-projects">Typing pre-existing projects</a></li>
<li><a href="#type-debugging---part-2">Type debugging - Part 2</a></li>
<li><a href="#typing-context-managers">Typing Context managers</a></li>
<li><a href="#typing-async-functions">Typing async functions</a></li>
<li><a href="#generics">Generics</a>
<ul>
<li><a href="#generic-functions">Generic functions</a></li>
<li><a href="#generic-classes">Generic classes</a></li>
<li><a href="#generic-types">Generic types</a></li>
</ul>
</li>
<li><a href="#advancedrecursive-type-checking-with-protocol">Advanced/Recursive type checking with <code data-astro-raw="">Protocol</code></a></li>
<li><a href="#further-learning">Further learning</a></li>
</ul><h2 id="setting-up-mypy">Setting up mypy</h2><p>All you really need to do to set it up is <code data-astro-raw="">pip install mypy</code>.</p><h3 id="using-mypy-in-the-terminal">Using mypy in the terminal</h3><p>Let's create a regular python file, and call it <code data-astro-raw="">test.py</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">double</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token number">2</span>

num <span class="token operator">=</span> double<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span></code></pre><p>This doesn't have any type definitions yet, but let's run mypy over it to see what it says.</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy test.py
Success: no issues found <span class="token keyword">in</span> <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span></code></pre><p>ü§®</p><p>Don't worry though, it's nothing unexpected. As explained in <a href="/post/does-python-need-types">my previous article</a>, <strong>mypy doesn't force you to add types to your code</strong>. But, if it finds types, it will evaluate them.</p><p>This can definitely lead to mypy missing entire parts of your code just because you accidentally forgot to add types.</p><p>Thankfully, there's ways to customise mypy to tell it to always check for stuff:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy --disallow-untyped-defs test.py
test.py:1: error: Function is missing a <span class="token builtin class-name">return</span> <span class="token builtin class-name">type</span> annotation
Found <span class="token number">1</span> error <span class="token keyword">in</span> <span class="token number">1</span> <span class="token function">file</span> <span class="token punctuation">(</span>checked <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span><span class="token punctuation">)</span></code></pre><p>And now it gave us the error we wanted.</p><p>There are a lot of these <code data-astro-raw="">--disallow-</code> arguments that we should be using if we are starting a new project to prevent such mishaps, but mypy gives us an extra powerful one that does it all: <code data-astro-raw="">--strict</code></p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy --strict test.py
test.py:1: error: Function is missing a <span class="token builtin class-name">return</span> <span class="token builtin class-name">type</span> annotation
test.py:4: error: Call to untyped <span class="token keyword">function</span> <span class="token string">"give_number"</span> <span class="token keyword">in</span> typed context
Found <span class="token number">2</span> errors <span class="token keyword">in</span> <span class="token number">1</span> <span class="token function">file</span> <span class="token punctuation">(</span>checked <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span><span class="token punctuation">)</span></code></pre><figcaption>The actual mypy output is all nice and colourful
</figcaption><p>This gave us even more information: the fact that we're using <code data-astro-raw="">give_number</code> in our code, which doesn't have a defined return type, so that piece of code also can have unintended issues.</p><blockquote>
<p><strong>TL;DR</strong>: for starters, use <code data-astro-raw="">mypy --strict filename.py</code></p>
</blockquote><h3 id="using-mypy-in-vscode">Using mypy in VSCode</h3><p>VSCode has pretty good integration with mypy. All you need to get mypy working with it is to add this to your <code data-astro-raw="">settings.json</code>:</p><pre class="language-json"><code data-astro-raw="" class="language-json">...
  <span class="token property">"python.linting.mypyEnabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"python.linting.mypyArgs"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"--ignore-missing-imports"</span><span class="token punctuation">,</span>
    <span class="token string">"--follow-imports=silent"</span><span class="token punctuation">,</span>
    <span class="token string">"--show-column-numbers"</span><span class="token punctuation">,</span>
    <span class="token string">"--strict"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
...</code></pre><p>Now opening your code folder in python should show you the exact same errors in the "Problems" pane:</p><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7d9go5wksy1ot63f8ib4.png" alt="VSCode Problems pane showing the same errors"></p><blockquote>
<p>Also, if you're using VSCode I'll highly suggest installing <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.vscode-pylance">Pylance</a> from the Extensions panel, it'll help a lot with tab-completion and getting better insight into your types.</p>
</blockquote><p>Okay, now on to actually fixing these issues.</p><h2 id="primitive-types">Primitive types</h2><p>The most fundamental types that exist in mypy are the primitive types. To name a few:</p><ul>
<li><code data-astro-raw="">int</code></li>
<li><code data-astro-raw="">str</code></li>
<li><code data-astro-raw="">float</code></li>
<li><code data-astro-raw="">bool</code>
...</li>
</ul><p>Notice a pattern?</p><p>Yup. These are the same exact primitive Python data types that you're familiar with.</p><p>And these are actually all we need to fix our errors:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">double</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token number">2</span>


num <span class="token operator">=</span> double<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span></code></pre><p>All we've changed is the function's definition in <code data-astro-raw="">def</code>:</p><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qvdyekz839662s6krh01.png" alt="The code's diff"></p><figcaption>Notice the highlighted part</figcaption><p>What this says is "function <code data-astro-raw="">double</code> takes an argument <code data-astro-raw="">n</code> which is an <code data-astro-raw="">int</code>, and the function returns an <code data-astro-raw="">int</code>.</p><p>And running mypy now:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy --strict test.py
Success: no issues found <span class="token keyword">in</span> <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span></code></pre><p><img src="https://i.fluffy.cc/MKjDMmwXxZlqRTwnn070gVqZ8Rwh6d3p.gif" alt="Ship it!"></p><p>Congratulations, you've just written your first type-checked Python program üéâ</p><p>We can run the code to verify that it indeed, does work:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ python test.py
<span class="token number">42</span></code></pre><blockquote>
<p>I should clarify, that mypy does all of its type checking without ever running the code. It is what's called a <strong>static analysis tool</strong> (this static is different from the static in "static typing"), and essentially what it means is that it works not by running your python code, but by <strong>evaluating your program's structure</strong>. What this means is, if your program does interesting things like making API calls, or deleting files on your system, you can still run mypy over your files and it will have no real-world effect.</p>
</blockquote><p>What is interesting to note, is that we have declared <code data-astro-raw="">num</code> in the program as well, but we never told mypy what type it is going to be, and yet it still worked just fine.</p><p>We could tell mypy what type it is, like so:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">double</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token number">2</span>


num<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> double<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span></code></pre><p>And mypy would be equally happy with this as well. But we don't have to provide this type, because mypy knows its type already. Because <code data-astro-raw="">double</code> is only supposed to return an <code data-astro-raw="">int</code>, <strong>mypy inferred it</strong>:</p><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/enz740p3lztmic7c7us4.png" alt="image"></p><figcaption>Basic inference actually works without Pylance too.</figcaption><p>And <em>inference is cool</em>. For 80% of the cases, you'll only be writing types for function and method definitions, as we did in the first example. One notable exception to this is "empty collection types", which we will discuss now.</p><h2 id="collection-types">Collection types</h2><p>Collection types are how you're able to add types to collections, such as "a list of strings", or "a dictionary with string keys and boolean values", and so on.</p><p>Some collection types include:</p><ul>
<li><code data-astro-raw="">List</code></li>
<li><code data-astro-raw="">Dict</code></li>
<li><code data-astro-raw="">Set</code></li>
<li><code data-astro-raw="">DefaultDict</code></li>
<li><code data-astro-raw="">Deque</code></li>
<li><code data-astro-raw="">Counter</code></li>
</ul><p>Now these might sound very familiar, <strong>these aren't the same as the builtin collection types</strong> (more on that later).</p><p>These are all defined in the <code data-astro-raw="">typing</code> module that comes built-in with Python, and there's one thing that all of these have in common: they're <em>generic</em>.</p><p>I have an entire section dedicated to generics below, but what it boils down to is that "with generic types, you can pass types inside other types". Here's how you'd use collection types:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">def</span> <span class="token function">average</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
    count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
    <span class="token keyword">return</span> total <span class="token operator">/</span> count

<span class="token keyword">print</span><span class="token punctuation">(</span>average<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 2.5</span></code></pre><p>This tells mypy that <code data-astro-raw="">nums</code> should be a list of integers (<code data-astro-raw="">List[int]</code>), and that <code data-astro-raw="">average</code> returns a <code data-astro-raw="">float</code>.</p><p>Here's a couple more examples:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict

<span class="token keyword">def</span> <span class="token function">get_total_marks</span><span class="token punctuation">(</span>scorecard<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    marks <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>scorecard<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># marks : List[int]</span>
    <span class="token keyword">return</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>marks<span class="token punctuation">)</span>

scores <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'english'</span><span class="token punctuation">:</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token string">'maths'</span><span class="token punctuation">:</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token string">'history'</span><span class="token punctuation">:</span> <span class="token number">75</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>get_total_marks<span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 251</span></code></pre><p>Remember when I said that empty collections is one of the rare cases that need to be typed? This is because there's no way for mypy to infer the types in that case:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">def</span> <span class="token function">unique_count</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""counts the number of unique items in the list"""</span>
    uniques <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># How does mypy know what type this is?</span>
    <span class="token keyword">for</span> num <span class="token keyword">in</span> nums<span class="token punctuation">:</span>
        uniques<span class="token punctuation">.</span>add<span class="token punctuation">(</span>num<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>uniques<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>unique_count<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 4</span></code></pre><p>Since the set has no items to begin with, mypy can't statically infer what type it should be.</p><details>
<summary>PS.</summary>
<p><em>Small note, if you try to run mypy on the piece of code above, it'll actually succeed. It's because the mypy devs are smart, and they added simple cases of look-ahead inference. Meaning, new versions of mypy can figure out such types in simple cases. Keep in mind that it doesn't always work.</em></p>
</details><p>To fix this, you can manually add in the required type:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Set

<span class="token keyword">def</span> <span class="token function">unique_count</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""counts the number of unique items in the list"""</span>
    uniques<span class="token punctuation">:</span> Set<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Manually added type information</span>
    <span class="token keyword">for</span> num <span class="token keyword">in</span> nums<span class="token punctuation">:</span>
        uniques<span class="token punctuation">.</span>add<span class="token punctuation">(</span>num<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>uniques<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>unique_count<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 4</span></code></pre><blockquote>
<p><strong>Note</strong>: Starting from Python 3.7, you can add a future import, <code data-astro-raw="">from __future__ import annotations</code> at the top of your files, which will allow you to use the builtin types as generics, i.e. you can use <code data-astro-raw="">list[int]</code> instead of <code data-astro-raw="">List[int]</code>. If you're using Python 3.9 or above, you can use this syntax without needing the <code data-astro-raw="">__future__</code> import at all. However, there are some edge cases where it might not work, so in the meantime I'll suggest using the <code data-astro-raw="">typing.List</code> variants. This is detailed in <a href="https://www.python.org/dev/peps/pep-0585/">PEP 585</a>.</p>
</blockquote><h2 id="type-debugging---part-1">Type debugging - Part 1</h2><p>Let's say you're reading someone else's ‚Äî or your own past self's ‚Äî code, and it's not really apparent what the type of a variable is. The code is using a lot of inference, and it's using some builtin methods that you don't exactly remember how they work, bla bla.</p><p>Thankfully mypy lets you reveal the type of any variable by using <code data-astro-raw="">reveal_type</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Set

<span class="token keyword">def</span> <span class="token function">unique_count</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""counts the number of unique items in the list"""</span>
    uniques<span class="token punctuation">:</span> Set<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> num <span class="token keyword">in</span> nums<span class="token punctuation">:</span>
        uniques<span class="token punctuation">.</span>add<span class="token punctuation">(</span>num<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>uniques<span class="token punctuation">)</span>

counts <span class="token operator">=</span> unique_count<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

reveal_type<span class="token punctuation">(</span>counts<span class="token punctuation">)</span>  <span class="token comment"># The special magic reveal_type method</span></code></pre><p>Running mypy on this piece of code gives us:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy --strict test.py
test.py:12: note: Revealed <span class="token builtin class-name">type</span> is <span class="token string">'builtins.int'</span></code></pre><p>Ignore the builtins for now, it's able to tell us that <code data-astro-raw="">counts</code> here is an <code data-astro-raw="">int</code>.</p><p>Cool, right? You don't need to rely on an IDE or VSCode, to use hover to check the types of a variable. A simple terminal and mypy is all you need. <em>(although VSCode internally uses a similar process to this to get all type informations)</em></p><p>However, some of you might be wondering where <code data-astro-raw="">reveal_type</code> came from. We didn't import it from <code data-astro-raw="">typing</code>... is it a new builtin? Is that even valid in python?</p><p>And sure enough, if you try to run the code:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ py test.py
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:
  File <span class="token string">"/home/tushar/code/test/test.py"</span>, line <span class="token number">12</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    reveal_type<span class="token punctuation">(</span>counts<span class="token punctuation">)</span>
NameError: name <span class="token string">'reveal_type'</span> is not defined</code></pre><p><code data-astro-raw="">reveal_type</code> is a special "mypy function". Since python doesn't know about types (type annotations are ignored at runtime), only mypy knows about the types of variables when it runs its type checking. So, only mypy can work with <code data-astro-raw="">reveal_type</code>.</p><p>All this means, is that <strong>you should only use <code data-astro-raw="">reveal_type</code> to debug your code, and remove it when you're done debugging</strong>.</p><h2 id="union-and-optional">Union and Optional</h2><p>So far, we have only seen variables and collections that can hold only one type of value. But what about this piece of code?</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">print_favorite_color</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fav_color <span class="token operator">=</span> person<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'favorite-color'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> fav_color <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"You don't have a favorite color. üòø"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Your favorite color is </span><span class="token interpolation"><span class="token punctuation">{</span>fav_color<span class="token punctuation">}</span></span><span class="token string">! üò∏."</span></span><span class="token punctuation">)</span>

me <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Tushar'</span><span class="token punctuation">,</span> <span class="token string">'favorite-color'</span><span class="token punctuation">:</span> <span class="token string">'Purple'</span><span class="token punctuation">}</span>
print_favorite_color<span class="token punctuation">(</span>me<span class="token punctuation">)</span></code></pre><p>What's the type of <code data-astro-raw="">fav_color</code> in this code?</p><p>Let's try to do a <code data-astro-raw="">reveal_type</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict

<span class="token keyword">def</span> <span class="token function">print_favorite_color</span><span class="token punctuation">(</span>person<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>  <span class="token comment"># added types to function definiton</span>
    fav_color <span class="token operator">=</span> person<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'favorite-color'</span><span class="token punctuation">)</span>
    reveal_type<span class="token punctuation">(</span>fav_color<span class="token punctuation">)</span>  <span class="token comment"># added this line here</span>
    <span class="token keyword">if</span> fav_color <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"You don't have a favorite color. üòø"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Your favorite color is </span><span class="token interpolation"><span class="token punctuation">{</span>fav_color<span class="token punctuation">}</span></span><span class="token string">! üò∏."</span></span><span class="token punctuation">)</span>

me <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Tushar'</span><span class="token punctuation">,</span> <span class="token string">'favorite-color'</span><span class="token punctuation">:</span> <span class="token string">'Purple'</span><span class="token punctuation">}</span>
print_favorite_color<span class="token punctuation">(</span>me<span class="token punctuation">)</span></code></pre><blockquote>
<p><em>BTW, since this function has no return statement, its return type is <code data-astro-raw="">None</code>.</em></p>
</blockquote><p>Running mypy on this:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy test.py
test.py:5: note: Revealed <span class="token builtin class-name">type</span> is <span class="token string">'Union[builtins.str*, None]'</span></code></pre><p>And we get one of our two new types: <em>Union</em>. Specifically, <code data-astro-raw="">Union[str, None]</code>.</p><p>All this means, is that <code data-astro-raw="">fav_color</code> can be one of two different types, <strong>either <code data-astro-raw="">str</code>, or <code data-astro-raw="">None</code></strong>.</p><p>And unions are actually very important for Python, because of how Python does polymorphism. Here's a simpler example:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">print_item</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> data <span class="token keyword">in</span> item<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>

print_item<span class="token punctuation">(</span><span class="token string">'Hi!'</span><span class="token punctuation">)</span>
print_item<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'This is a test'</span><span class="token punctuation">,</span> <span class="token string">'of polymorphism'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ python test.py
Hi<span class="token operator">!</span>
This is a <span class="token builtin class-name">test</span>
of polymorphism</code></pre><p>Now let's add types to it, and learn some things by using our friend <code data-astro-raw="">reveal_type</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Union

<span class="token keyword">def</span> <span class="token function">print_item</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    reveal_type<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> data <span class="token keyword">in</span> item<span class="token punctuation">:</span>
            reveal_type<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        reveal_type<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>

print_item<span class="token punctuation">(</span><span class="token string">'Hi!'</span><span class="token punctuation">)</span>
print_item<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'This is a test'</span><span class="token punctuation">,</span> <span class="token string">'of polymorphism'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>Can you guess the output of the <code data-astro-raw="">reveal_type</code>s?</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy test.py
test.py:4: note: Revealed <span class="token builtin class-name">type</span> is <span class="token string">'Union[builtins.str, builtins.list[builtins.str]]'</span>
test.py:8: note: Revealed <span class="token builtin class-name">type</span> is <span class="token string">'builtins.list[builtins.str]'</span>
test.py:11: note: Revealed <span class="token builtin class-name">type</span> is <span class="token string">'builtins.str'</span></code></pre><p>Mypy is smart enough, where if you add an <code data-astro-raw="">isinstance(...)</code> check to a variable, it will correctly assume that the type inside that block is <em>narrowed to that type.</em></p><p>In our case, <code data-astro-raw="">item</code> was correctly identified as <code data-astro-raw="">List[str]</code> inside the <code data-astro-raw="">isinstance</code> block, and <code data-astro-raw="">str</code> in the <code data-astro-raw="">else</code> block.</p><p>This is an extremely powerful feature of mypy, called <strong>Type narrowing</strong>.</p><p>Now, here's a more contrived example, a type-annotated Python implementation of the builtin function <code data-astro-raw="">abs</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> math <span class="token keyword">import</span> sqrt
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Union

<span class="token keyword">def</span> <span class="token function">my_abs</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token builtin">complex</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> <span class="token builtin">complex</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># absolute value of a complex number is sqrt(i^2 + j^2)</span>
        <span class="token keyword">return</span> sqrt<span class="token punctuation">(</span>num<span class="token punctuation">.</span>real <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> num<span class="token punctuation">.</span>imag <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> num <span class="token keyword">if</span> num <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token operator">-</span>num

<span class="token keyword">print</span><span class="token punctuation">(</span>my_abs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5.6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 5.6</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>my_abs<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 42</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>my_abs<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>my_abs<span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">-</span><span class="token number">8j</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 10.0</span></code></pre><p>And that's everything you need to know about Union.</p><p>... so what's <code data-astro-raw="">Optional</code> you ask?</p><p>Well, <code data-astro-raw="">Union[X, None]</code> seemed to occur so commonly in Python, that they decided it needs a shorthand. <code data-astro-raw="">Optional[str]</code> is just a shorter way to write <code data-astro-raw="">Union[str, None]</code>.</p><h2 id="any-type">Any type</h2><p>If you ever try to run <code data-astro-raw="">reveal_type</code> inside an untyped function, this is what happens:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">average</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>
    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
    count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>

    ans <span class="token operator">=</span> total <span class="token operator">/</span> count
    reveal_type<span class="token punctuation">(</span>ans<span class="token punctuation">)</span></code></pre><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy test.py
test.py:6: note: Revealed <span class="token builtin class-name">type</span> is <span class="token string">'Any'</span>
test.py:6: note: <span class="token string">'reveal_type'</span> always outputs <span class="token string">'Any'</span> <span class="token keyword">in</span> unchecked functions</code></pre><figcaption>Didn't use --strict, or it'd throw errors</figcaption><p>The revealed type is told to be <code data-astro-raw="">Any</code>.</p><p><code data-astro-raw="">Any</code> just means that <em>anything can be passed here</em>. Whatever is passed, mypy should just accept it. In other words, <strong><code data-astro-raw="">Any</code> turns off type checking</strong>.</p><p>Of course, this means that <em>if you want to take advantage of mypy, you should avoid using <code data-astro-raw="">Any</code> as much as you can</em>.</p><p>But since Python is inherently a dynamically typed language, in some cases it's impossible for you to know what the type of something is going to be. For such cases, you can use <code data-astro-raw="">Any</code>. For example:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">import</span> json
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Any

<span class="token keyword">import</span> requests

<span class="token keyword">def</span> <span class="token function">post_data_to_api</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'https://example.com/post'</span><span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">)</span>

data <span class="token operator">=</span> <span class="token string">'{"num": 42, "info": null}'</span>
parsed_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
reveal_type<span class="token punctuation">(</span>parsed_data<span class="token punctuation">)</span>  <span class="token comment"># Revealed type is 'Any'</span>

post_data_to_api<span class="token punctuation">(</span>data<span class="token punctuation">)</span></code></pre><p>You can also use <code data-astro-raw="">Any</code> as a placeholder value for something while you figure out what it should be, to make mypy happy in the meanwhile. But make sure to get rid of the <code data-astro-raw="">Any</code> if you can .</p><h2 id="miscellaneous-types">Miscellaneous types</h2><h3 id="tuple">Tuple</h3><p>You might think of tuples as an immutable list, but Python thinks of it in a very different way.</p><p>Tuples are different from other collections, as they are essentially a way to represent a collection of data points related to an entity, kinda similar to how a C <code data-astro-raw="">struct</code> is stored in memory. While other collections usually represent a bunch of objects, <strong>tuples usually represent a single object</strong>.</p><p>A good example is sqlite:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT name, age, bio FROM users'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'Joe'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token string">'Hello!'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token string">'Web developer from California.'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span></code></pre><p>Tuples also come in handy when you want to return multiple values from a function, for example:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">next_two</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token operator">+</span><span class="token number">2</span>

nums <span class="token operator">=</span> next_two<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>  <span class="token comment"># (4, 5)</span></code></pre><p>Because of these reasons, tuples tend to have a fixed length, with each index having a specific type. (Our sqlite example had an array of length 3 and types <code data-astro-raw="">int</code>, <code data-astro-raw="">str</code> and <code data-astro-raw="">int</code> respectively.</p><p>Here's how you'd type a tuple:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Tuple

<span class="token keyword">def</span> <span class="token function">print_info</span><span class="token punctuation">(</span>user_info<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> bio <span class="token operator">=</span> user_info
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"My name is </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">, I am </span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">}</span></span><span class="token string"> years old, and I am a </span><span class="token interpolation"><span class="token punctuation">{</span>bio<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

user_info <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'Tushar'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'Developer from India.'</span><span class="token punctuation">)</span>
print_info<span class="token punctuation">(</span>user_info<span class="token punctuation">)</span> <span class="token comment"># My name is Tushar, I am 21 years old, and I am a Developer from India.</span></code></pre><p>However, sometimes you do have to create variable length tuples. You can use the <code data-astro-raw="">Tuple[X, ...]</code> syntax for that.</p><p>The <code data-astro-raw="">...</code> in this case simply means there's a variable number of elements in the array, but their type is <code data-astro-raw="">X</code>. For example:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Tuple

<span class="token keyword">def</span> <span class="token function">print_veggies</span><span class="token punctuation">(</span>veggies<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> veg <span class="token keyword">in</span> veggies<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>veg<span class="token punctuation">)</span>

veggies <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'Potato'</span><span class="token punctuation">,</span> <span class="token string">'Tomato'</span><span class="token punctuation">,</span> <span class="token string">'Onion'</span><span class="token punctuation">)</span>
print_veggies<span class="token punctuation">(</span>veggies<span class="token punctuation">)</span></code></pre><h3 id="typeddict">TypedDict</h3><p>A <code data-astro-raw="">TypedDict</code> is a dictionary whose keys are always string, and values are of the specified type. At runtime, it behaves exactly like a normal dictionary.</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span>TypedDict<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">:</span> <span class="token builtin">int</span>
    y<span class="token punctuation">:</span> <span class="token builtin">int</span>
    label<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token comment"># Can also be created as:</span>
<span class="token comment"># Vector = TypedDict('Vector', x=int, y=int, label=str)</span>

a<span class="token punctuation">:</span> Vector <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">'good'</span><span class="token punctuation">}</span>  <span class="token comment"># OK</span>
b<span class="token punctuation">:</span> Vector <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'z'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">'bad'</span><span class="token punctuation">}</span>           <span class="token comment"># Fails type check</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Vector<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'first'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'first'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># True</span></code></pre><p>By default, all keys must be present in a <code data-astro-raw="">TypedDict</code>. It is possible to override this by specifying <code data-astro-raw="">total=False</code>.</p><h3 id="literal">Literal</h3><p>A <code data-astro-raw="">Literal</code> represents the type of a literal value. You can use it to constrain already existing types like <code data-astro-raw="">str</code> and <code data-astro-raw="">int</code>, to just some specific values of them. Like so:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Literal

<span class="token keyword">def</span> <span class="token function">i_only_take_5</span><span class="token punctuation">(</span>val <span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"yay! you passed a 5!"</span><span class="token punctuation">)</span>

i_only_take_5<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># OK</span>
i_only_take_5<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token comment"># Fails type check</span></code></pre><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy test.py
test.py:7: error: Argument <span class="token number">1</span> to <span class="token string">"i_only_take_5"</span> has incompatible <span class="token builtin class-name">type</span> <span class="token string">"Literal[6]"</span><span class="token punctuation">;</span> expected <span class="token string">"Literal[5]"</span></code></pre><p>This has some interesting use-cases. A notable one is to use it in place of simple enums:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Any<span class="token punctuation">,</span> Literal

<span class="token keyword">def</span> <span class="token function">make_request</span><span class="token punctuation">(</span>method<span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'DELETE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'makinng a </span><span class="token interpolation"><span class="token punctuation">{</span>method<span class="token punctuation">}</span></span><span class="token string"> HTTP request...'</span></span><span class="token punctuation">)</span>
    <span class="token comment"># ... HTTP code here</span>

make_request<span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1234</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment"># OK</span>
make_request<span class="token punctuation">(</span><span class="token string">'DLETE'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1234</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment"># Fails type check</span></code></pre><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy test.py
test.py:8: error: Argument <span class="token number">1</span> to <span class="token string">"make_request"</span> has incompatible <span class="token builtin class-name">type</span> <span class="token string">"Literal['DLETE']"</span><span class="token punctuation">;</span> expected <span class="token string">"Union[Literal['GET'], Literal['POST'], Literal['DELETE']]"</span></code></pre><p>Oops, you made a typo in <code data-astro-raw="">'DELETE'</code>! Don't worry, mypy saved you an hour of debugging.</p><h3 id="final">Final</h3><p><code data-astro-raw="">Final</code> is an annotation that declares a variable as final. What that means that the variable cannot be re-assigned to. This is similar to <code data-astro-raw="">final</code> in Java and <code data-astro-raw="">const</code> in JavaScript.</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Final

api_url <span class="token punctuation">:</span> Final <span class="token operator">=</span> <span class="token string">'https://example.com/m_api'</span>

<span class="token comment"># ... some other code</span>

api_url <span class="token operator">=</span> <span class="token string">'something else'</span>  <span class="token comment"># Error: Cannot assign to final name "api_url"</span></code></pre><h3 id="noreturn">NoReturn</h3><p><code data-astro-raw="">NoReturn</code> is an interesting type. It's rarely ever used, but it still needs to exist, for that one time where you might have to use it.</p><p>There are cases where you can have a function that might never return. Two possible reasons that I can think of for this are:</p><ul>
<li>The function always raises an exception, or</li>
<li>The function is an infinite loop.</li>
</ul><p>Here's an example of both:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue
<span class="token keyword">from</span> typing <span class="token keyword">import</span> NoReturn

message_queue<span class="token punctuation">:</span> Queue<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">event_loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> NoReturn<span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        message <span class="token operator">=</span> message_queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'got </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token comment"># ... do something with the message</span></code></pre><p>Note that in both these cases, typing the function as <code data-astro-raw="">-&gt; None</code> will also work. But if you intend for a function to never return anything, you should type it as <code data-astro-raw="">NoReturn</code>, because then mypy will show an error if the function were to ever have a condition where it does return.</p><p>For example, if you edit <code data-astro-raw="">while True:</code> to be <code data-astro-raw="">while False:</code> or <code data-astro-raw="">while some_condition()</code> in the first example, mypy will throw an error:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy test.py
test.py:6: error: Implicit <span class="token builtin class-name">return</span> <span class="token keyword">in</span> <span class="token keyword">function</span> <span class="token function">which</span> does not <span class="token builtin class-name">return</span></code></pre><h2 id="typing-classes">Typing classes</h2><p>All class methods are essentially typed just like regular functions, except for <code data-astro-raw="">self</code>, which is left untyped. Here's a simple Stack class:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">class</span> <span class="token class-name">Stack</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_values<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'Stack</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>_values<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">'</span></span>

    <span class="token keyword">def</span> <span class="token function">push</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_values<span class="token punctuation">.</span>append<span class="token punctuation">(</span>value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">pop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_values<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">'Underflow!'</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_values<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>

stack <span class="token operator">=</span> Stack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span>        <span class="token comment"># Stack[]</span>

stack<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
stack<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span>        <span class="token comment"># Stack[2, 10]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 10</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span>        <span class="token comment"># Stack[2]</span></code></pre><blockquote>
<p>If you've never seen the <code data-astro-raw="">{x!r}</code> syntax inside f-strings, it's a way to use the <code data-astro-raw="">repr()</code> of a value. For more information, <a href="https://pyformat.info">pyformat.info</a> is a very good resource for learning Python's string formatting features.</p>
</blockquote><p>There's however, one caveat to typing classes: You can't normally access the class itself inside the class' function declarations (because the class hasn't been finished declaring itself yet, because you're still declaring its methods).</p><p>So something like this isn't valid Python:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x

    <span class="token keyword">def</span> <span class="token function">copy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> MyClass<span class="token punctuation">:</span>
        copied_object <span class="token operator">=</span> MyClass<span class="token punctuation">(</span>x<span class="token operator">=</span>self<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> copied_object</code></pre><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy --strict test.py
Success: no issues found <span class="token keyword">in</span> <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span>

$ python test.py
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:
  File <span class="token string">"/home/tushar/code/test/test.py"</span>, line <span class="token number">11</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    class MyClass:
  File <span class="token string">"/home/tushar/code/test/test.py"</span>, line <span class="token number">15</span>, <span class="token keyword">in</span> MyClass
    def copy<span class="token punctuation">(</span>self<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> MyClass:
NameError: name <span class="token string">'MyClass'</span> is not defined</code></pre><p>There's two ways to fix this:</p><ul>
<li>Turn the classname into a string: The creators of PEP 484 and Mypy knew that such cases exist where you might need to define a return type which doesn't exist yet. So, mypy is able to check types if they're wrapped in strings.</li>
</ul><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x

    <span class="token keyword">def</span> <span class="token function">copy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">'MyClass'</span><span class="token punctuation">:</span>
        copied_object <span class="token operator">=</span> MyClass<span class="token punctuation">(</span>x<span class="token operator">=</span>self<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> copied_object</code></pre><ul>
<li>Use <code data-astro-raw="">from __future__ import annotations</code>. What this does, is turn on a new feature in Python called "postponed evaluation of type annotations". This essentially makes Python treat all type annotations as strings, storing them in the internal <code data-astro-raw="">__annotations__</code> attribute. Details are described in <a href="https://www.python.org/dev/peps/pep-0563/">PEP 563</a>.</li>
</ul><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations

<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x

    <span class="token keyword">def</span> <span class="token function">copy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> MyClass<span class="token punctuation">:</span>
        copied_object <span class="token operator">=</span> MyClass<span class="token punctuation">(</span>x<span class="token operator">=</span>self<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> copied_object</code></pre><blockquote>
<p>Starting with Python 3.11, the Postponed evaluation behaviour will become default, and you won't need to have the <code data-astro-raw="">__future__</code> import anymore.</p>
</blockquote><h2 id="typing-namedtuples">Typing namedtuples</h2><p><code data-astro-raw="">namedtuple</code>s are a lot like tuples, except every index of their fields is named, and they have some syntactic sugar which allow you to access its properties like attributes on an object:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple

Person <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'bio'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ishan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'Ishan'</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token string">'Writer'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>ishan<span class="token punctuation">)</span>      <span class="token comment"># Person(name='Ishan', age=31, bio='Writer')</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ishan<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment"># 31</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ishan<span class="token punctuation">.</span>bio<span class="token punctuation">)</span>  <span class="token comment"># Writer</span></code></pre><p>Since the underlying data structure is a tuple, and there's no real way to provide any type information to namedtuples, by default this will have a type of <code data-astro-raw="">Tuple[Any, Any, Any]</code>.</p><p>To combat this, Python has added a <code data-astro-raw="">NamedTuple</code> class which you can extend to have the typed equivalent of the same:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> NamedTuple

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>NamedTuple<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>
    bio<span class="token punctuation">:</span> <span class="token builtin">str</span>

ishan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'Ishan'</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token string">'Writer'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>ishan<span class="token punctuation">)</span>        <span class="token comment"># Person(name='Ishan', age=31, bio='Writer')</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ishan<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>     <span class="token comment"># 31</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ishan<span class="token punctuation">.</span>bio<span class="token punctuation">)</span>    <span class="token comment"># Writer</span>

reveal_type<span class="token punctuation">(</span>ishan<span class="token punctuation">)</span>  <span class="token comment"># Revealed type is Tuple[str, int, str]</span></code></pre><details>
<summary>Inner workings of NamedTuple:</summary>
<p>If you're curious how <code data-astro-raw="">NamedTuple</code> works under the hood: <code data-astro-raw="">age: int</code> is a <strong>type declaration</strong>, without any assignment (like <code data-astro-raw="">age : int = 5</code>).</p>
<p>Type declarations inside a function or class don't actually define the variable, but they add the type annotation to that function or class' <em>metadata</em>, in the form of a dictionary entry, into <code data-astro-raw="">x.__annotations__</code>.</p>
<p>Doing <code data-astro-raw="">print(ishan.__annotations__)</code> in the code above gives us <code data-astro-raw="">{'name': &lt;class 'str'&gt;, 'age': &lt;class 'int'&gt;, 'bio': &lt;class 'str'&gt;}</code>.</p>
<p><code data-astro-raw="">typing.NamedTuple</code> uses these annotations to create the required tuple.</p>
</details><h2 id="typing-decorators">Typing decorators</h2><p>Decorators are a fairly advanced, but really powerful feature of Python. If you don't know anything about decorators, I'd recommend you to watch <a href="https://www.youtube.com/watch?v=WDMr6WolKUM">Anthony explains decorators</a>, but I'll explain it in brief here as well.</p><p>A decorator is essentially a function that wraps another function. Decorators can extend the functionalities of pre-existing functions, by running other side-effects whenever the original function is called. A decorator <strong>decorates a function by adding new functionality</strong>.</p><p>A simple example would be to monitor how long a function takes to run:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> time <span class="token keyword">import</span> time<span class="token punctuation">,</span> sleep

<span class="token keyword">def</span> <span class="token function">time_it</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
        end_time <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        duration <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'function took </span><span class="token interpolation"><span class="token punctuation">{</span>duration<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> seconds to run'</span></span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@time_it</span>
<span class="token keyword">def</span> <span class="token function">long_computation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">42</span>

long_computation<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>To be able to type this, we'd need a way to be able to define the type of a function. That way is called <code data-astro-raw="">Callable</code>.</p><p><code data-astro-raw="">Callable</code> is a generic type with the following syntax:</p><p><code data-astro-raw="">Callable[[&lt;list of argument types&gt;], &lt;return type&gt;]</code></p><p>The types of a function's arguments goes into the first list inside <code data-astro-raw="">Callable</code>, and the return type follows after. A few examples:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> Optional

<span class="token keyword">def</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">func2</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">def</span> <span class="token function">func3</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> nums<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>

reveal_type<span class="token punctuation">(</span>func1<span class="token punctuation">)</span>  <span class="token comment"># Callable[[], None]</span>
reveal_type<span class="token punctuation">(</span>func2<span class="token punctuation">)</span>  <span class="token comment"># Callable[[int, str], bool]</span>
reveal_type<span class="token punctuation">(</span>func3<span class="token punctuation">)</span>  <span class="token comment"># Callable[[Dict[str, int]], Union[int, None]]</span></code></pre><p>Here's how you'd implenent the previously-shown <code data-astro-raw="">time_it</code> decorator:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> time <span class="token keyword">import</span> time<span class="token punctuation">,</span> sleep
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Callable

<span class="token keyword">def</span> <span class="token function">time_it</span><span class="token punctuation">(</span>func<span class="token punctuation">:</span> Callable<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Callable<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
        end_time <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        duration <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'function took </span><span class="token interpolation"><span class="token punctuation">{</span>duration<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> seconds to run'</span></span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@time_it</span>
<span class="token keyword">def</span> <span class="token function">long_computation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">42</span>

long_computation<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote>
<p>Note: <code data-astro-raw="">Callable</code> is what's called a <a href="https://devopedia.org/duck-typing">Duck Type</a>. What it means, is that you can create your own custom object, and make it a valid <code data-astro-raw="">Callable</code>, by implementing the magic method called <code data-astro-raw="">__call__</code>. I have a dedicated section where I go in-depth about duck types ahead.</p>
</blockquote><h2 id="typing-generators">Typing generators</h2><p>Generators are also a fairly advanced topic to completely cover in this article, and you can watch
<a href="https://www.youtube.com/watch?v=LjBa9sfJh7U">Anthony explains generators</a> if you've never heard of them. A brief explanation is this:</p><p>Generators are a bit like perpetual functions. Instead of returning a value a single time, they <code data-astro-raw="">yield</code> values out of them, which you can iterate over. When you <code data-astro-raw="">yield</code> a value from an iterator, its execution pauses. But when another value is requested from the generator, it resumes execution from where it was last paused. When the generator function returns, the iterator stops.</p><p>Here's an example:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">generator</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> <span class="token string">'start'</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token string-interpolation"><span class="token string">f'item number </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">'</span></span>

    <span class="token keyword">yield</span> <span class="token string">'end'</span>

    <span class="token keyword">return</span> <span class="token number">42</span>

<span class="token keyword">for</span> string <span class="token keyword">in</span> generator<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>

<span class="token comment"># Output:</span>
<span class="token comment"># start</span>
<span class="token comment"># item number 1</span>
<span class="token comment"># item number 2</span>
<span class="token comment"># item number 3</span>
<span class="token comment"># end</span></code></pre><p>To add type annotations to generators, you need <code data-astro-raw="">typing.Generator</code>. The syntax is as follows:</p><p><code data-astro-raw="">Generator[yield_type, throw_type, return_type]</code></p><p>With that knowledge, typing this is fairly straightforward:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Generator

<span class="token keyword">def</span> <span class="token function">generator</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Generator<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> <span class="token string">'start'</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token string-interpolation"><span class="token string">f'item number </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">'</span></span>

    <span class="token keyword">yield</span> <span class="token string">'end'</span>

    <span class="token keyword">return</span> <span class="token number">42</span>

<span class="token keyword">for</span> string <span class="token keyword">in</span> generator<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span></code></pre><p>Since we're not raising any errors in the generator, <code data-astro-raw="">throw_type</code> is <code data-astro-raw="">None</code>. And although the return type is <code data-astro-raw="">int</code> which is correct, we're not really using the returned value anyway, so you could use <code data-astro-raw="">Generator[str, None, None]</code> as well, and skip the <code data-astro-raw="">return</code> part altogether.</p><h2 id="typing-args-and-kwargs">Typing <code data-astro-raw="">*args</code> and <code data-astro-raw="">**kwargs</code></h2><p><code data-astro-raw="">*args</code> and <code data-astro-raw="">**kwargs</code> is a feature of python that lets you pass any number of arguments and keyword arguments to a function <em>(that's what the name <code data-astro-raw="">args</code> and <code data-astro-raw="">kwargs</code> stands for, but these names are just convention, you can name the variables anything)</em>. <a href="https://www.youtube.com/watch?v=CqafM-bsnW0">Anthony explains args and kwargs</a> pretty well in his video.</p><p>All the extra arguments passed to <code data-astro-raw="">*args</code> get turned into a tuple, and kewyord arguments turn into a dictionay, with the keys being the string keywords:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">i_can_take_any_values</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'got args:'</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'got kwargs:'</span><span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span>

i_can_take_any_values<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> answer<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token comment"># Output:</span>
<span class="token comment"># got args: (1, 16, 'Hello')</span>
<span class="token comment"># got kwargs: {'x': False, 'answer': 42}</span></code></pre><p>Since the <code data-astro-raw="">*args</code> will always be of typle <code data-astro-raw="">Tuple[X]</code>, and <code data-astro-raw="">**kwargs</code> will always be of type <code data-astro-raw="">Dict[str, X]</code>, we only need to provide one type value <code data-astro-raw="">X</code> to type them. Here's a practical example:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> NamedTuple<span class="token punctuation">,</span> Optional

<span class="token keyword">class</span> <span class="token class-name">Scorecard</span><span class="token punctuation">(</span>NamedTuple<span class="token punctuation">)</span><span class="token punctuation">:</span>
    english<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>
    maths<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>
    physics<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">build_scorecard</span><span class="token punctuation">(</span><span class="token operator">**</span>marks<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Scorecard<span class="token punctuation">:</span>
    reveal_type<span class="token punctuation">(</span>marks<span class="token punctuation">)</span>  <span class="token comment"># Revealed type is 'Dict[str, int]'</span>

    card <span class="token operator">=</span> Scorecard<span class="token punctuation">(</span>
        english<span class="token operator">=</span>marks<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'english'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        maths<span class="token operator">=</span>marks<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'maths'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        physics<span class="token operator">=</span>marks<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'physics'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> card

marks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'english'</span><span class="token punctuation">:</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token string">'physics'</span><span class="token punctuation">:</span> <span class="token number">84</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>build_scorecard<span class="token punctuation">(</span><span class="token operator">**</span>marks<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Scorecard(english=55, maths=None, physics=84)</span></code></pre><h2 id="duck-types">Duck types</h2><p><strong>Duck types</strong> are a pretty fundamental concept of python: the entirety of the <a href="https://docs.python.org/3/reference/datamodel.html">Python object model</a> is built around the idea of duck types.</p><p>Quoting Alex Martelli:</p><blockquote>
<p>"You don't really care for IS-A -- you really only care for BEHAVES-LIKE-A-(in-this-specific-context), so, if you do test, this behaviour is what you should be testing for."</p>
</blockquote><p>What it means is that Python doesn't really care <em>what</em> the type of an object is, but rather <strong>how does it behave</strong>.</p><p>I had a short note above in <a href="#typing-decorators">typing decorators</a> that mentioned duck typing a function with <code data-astro-raw="">__call__</code>, now here's the actual implementation:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Callable

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">42</span>

<span class="token keyword">class</span> <span class="token class-name">FakeFuncs</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">42</span>

fake_func <span class="token operator">=</span> FakeFuncs<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>func<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                           <span class="token comment"># 42</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fake_func<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                      <span class="token comment"># 42</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> Callable<span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment"># True</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>fake_func<span class="token punctuation">,</span> Callable<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span>

reveal_type<span class="token punctuation">(</span>func<span class="token punctuation">)</span>                       <span class="token comment"># Callable[[], int]</span>
reveal_type<span class="token punctuation">(</span>fake_func<span class="token punctuation">)</span>                  <span class="token comment"># FakeFuncs</span></code></pre><details>
<summary>PS.</summary>
<p><em>Running mypy over the above code is going to give a cryptic error about "Special Forms", don't worry about that right now, we'll fix this in the <a href="#protocol">Protocol</a> section. All I'm showing right now is that the Python code works.</em></p>
</details><p>You can see that Python agrees that both of these functions are "Call-able", i.e. you can call them using the <code data-astro-raw="">x()</code> syntax. (this is why the type is called <code data-astro-raw="">Callable</code>, and not something like <code data-astro-raw="">Function</code>)</p><p>What duck types provide you is to be able to define your function parameters and return types not in terms of <em>concrete classes</em>, but in terms of <em>how your object behaves</em>, giving you a lot more flexibility in what kinds of things you can utilize in your code now, and also allows much easier extensibility in the future without making "breaking changes".</p><p>A simple example here:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">def</span> <span class="token function">count_non_empty_strings</span><span class="token punctuation">(</span>strings<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">[</span>s <span class="token keyword">for</span> s <span class="token keyword">in</span> strings <span class="token keyword">if</span> s <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>count_non_empty_strings<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'def'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Output: 2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>count_non_empty_strings<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token comment"># Output: 0</span>


lines <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'xyz'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>count_non_empty_strings<span class="token punctuation">(</span>lines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment"># Output: 2</span></code></pre><p>Running this code with Python works just fine. But running mypy over this gives us the following error:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy test.py
test.py:12: error: Argument <span class="token number">1</span> to <span class="token string">"count_non_empty_strings"</span> has incompatible <span class="token builtin class-name">type</span> <span class="token string">"ValuesView[str]"</span><span class="token punctuation">;</span> expected <span class="token string">"List[str]"</span></code></pre><p><code data-astro-raw="">ValuesView</code> is the type when you do <code data-astro-raw="">dict.values()</code>, and although you could imagine it as a list of strings in this case, it's not exactly the type <code data-astro-raw="">List</code>.</p><p>In fact, none of the other sequence types like <code data-astro-raw="">tuple</code> or <code data-astro-raw="">set</code> are going to work with this code. You could patch it for some of the builtin types by doing <code data-astro-raw="">strings: Union[List[str], Set[str], ...]</code> and so on, but just how many types will you add? And what about third party/custom types?</p><p>The correct solution here is to use a <strong>Duck Type</strong> (yes, we finally got to the point). The only thing we want to ensure in this case is that the object can be iterated upon (which in Python terms means that it implements the <code data-astro-raw="">__iter__</code> magic method), and the right type for that is <code data-astro-raw="">Iterable</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Iterable

<span class="token keyword">def</span> <span class="token function">count_non_empty_strings</span><span class="token punctuation">(</span>strings<span class="token punctuation">:</span> Iterable<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">[</span>s <span class="token keyword">for</span> s <span class="token keyword">in</span> strings <span class="token keyword">if</span> s <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>count_non_empty_strings<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'def'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Output: 2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>count_non_empty_strings<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token comment"># Output: 0</span>


lines <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'xyz'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>count_non_empty_strings<span class="token punctuation">(</span>lines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment"># Output: 2</span></code></pre><p>And now mypy is happy with our code.</p><p>There are many, <em>many</em> of these duck types that ship within Python's <code data-astro-raw="">typing</code> module, and a few of them include:</p><ul>
<li><code data-astro-raw="">Sequence</code> for defining things that can be indexed and reversed, like <code data-astro-raw="">List</code> and <code data-astro-raw="">Tuple</code>.</li>
<li><code data-astro-raw="">MutableMapping</code>, for when you have a key-value pair kind-of data structure, like <code data-astro-raw="">dict</code>, but also others like <code data-astro-raw="">defaultdict</code>, <code data-astro-raw="">OrderedDict</code> and <code data-astro-raw="">Counter</code> from the collections module.</li>
<li><code data-astro-raw="">Collection</code>, if all you care about is having a finite number of items in your data structure, eg. a <code data-astro-raw="">set</code>, <code data-astro-raw="">list</code>, <code data-astro-raw="">dict</code>, or anything from the collections module.</li>
</ul><blockquote>
<p>If you haven't already at this point, you should really look into how python's syntax and top level functions hook into Python's object model via <code data-astro-raw="">__magic_methods__</code>, for essentially all of Python's behaviour. The documentation for it is <a href="https://docs.python.org/3/reference/datamodel.html">right here</a>, and there's an excellent <a href="https://www.youtube.com/watch?v=7lmCu8wz8ro">talk by James Powell</a> that really dives deep into this concept in the beginning.</p>
</blockquote><h2 id="function-overloading-with-overload">Function overloading with <code data-astro-raw="">@overload</code></h2><p>Let's write a simple <code data-astro-raw="">add</code> function that supports <code data-astro-raw="">int</code>'s and <code data-astro-raw="">float</code>'s:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num2<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2


<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 3</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 7.5</span>

list_a<span class="token punctuation">,</span> list_b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>

joined_list <span class="token operator">=</span> list_a <span class="token operator">+</span> list_b
last_index <span class="token operator">=</span> add<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>list_a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>joined_list<span class="token punctuation">[</span>last_index<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 7</span></code></pre><p>The implementation seems perfectly fine... but mypy isn't happy with it:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ test.py:15: error: No overload variant of <span class="token string">"__getitem__"</span> of <span class="token string">"list"</span> matches argument <span class="token builtin class-name">type</span> <span class="token string">"float"</span>
test.py:15: note: Possible overload variants:
test.py:15: note:     def __getitem__<span class="token punctuation">(</span>self, int<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> int
test.py:15: note:     def __getitem__<span class="token punctuation">(</span>self, slice<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> List<span class="token punctuation">[</span>int<span class="token punctuation">]</span></code></pre><p>What mypy is trying to tell us here, is that in the line:</p><p><code data-astro-raw="">print(joined_list[last_index])</code></p><p><code data-astro-raw="">last_index</code> <em>could</em> be of type <code data-astro-raw="">float</code>. And checking with reveal_type, that definitely is the case:</p><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fbiimqc22expxgmdgsks.png" alt="image"></p><p>And since it <em>could</em>, mypy won't allow you to use a possible float value to index a list, because that will error out.</p><p>One thing we could do is do an <code data-astro-raw="">isinstance</code> assertion on our side to convince mypy:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union


<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num2<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2


<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 3</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 7.5</span>

list_a<span class="token punctuation">,</span> list_b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>

joined_list <span class="token operator">=</span> list_a <span class="token operator">+</span> list_b
last_index <span class="token operator">=</span> add<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>list_a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>

reveal_type<span class="token punctuation">(</span>last_index<span class="token punctuation">)</span>             <span class="token comment"># Union[int, float]</span>
<span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>last_index<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
reveal_type<span class="token punctuation">(</span>last_index<span class="token punctuation">)</span>             <span class="token comment"># Now it's int</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>joined_list<span class="token punctuation">[</span>last_index<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>But this will be pretty cumbersome to do at every single place in our code where we use <code data-astro-raw="">add</code> with <code data-astro-raw="">int</code>'s. Also we as programmers <em>know</em>, that passing two <code data-astro-raw="">int</code>'s will only ever return an <code data-astro-raw="">int</code>. But how do we tell mypy that?</p><p>Answer: use <code data-astro-raw="">@overload</code>. The syntax basically replicates what we wanted to say in the paragraph above:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union<span class="token punctuation">,</span> overload

<span class="token decorator annotation punctuation">@overload</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> num2<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token decorator annotation punctuation">@overload</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> num2<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num2<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2


<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 3</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 7.5</span>

list_a<span class="token punctuation">,</span> list_b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>

joined_list <span class="token operator">=</span> list_a <span class="token operator">+</span> list_b
last_index <span class="token operator">=</span> add<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>list_a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>joined_list<span class="token punctuation">[</span>last_index<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>And now mypy knows that <code data-astro-raw="">add(3, 4)</code> returns an <code data-astro-raw="">int</code>.</p><blockquote>
<p>Note that Python has no way to ensure that the code actually always returns an <code data-astro-raw="">int</code> when it gets <code data-astro-raw="">int</code> values. It's your job as the programmer providing these overloads, to verify that they are correct. This is why in some cases, using <code data-astro-raw="">assert isinstance(...)</code> could be better than doing this, but for most cases <code data-astro-raw="">@overload</code> works fine.
Also, in the overload definitions <code data-astro-raw="">-&gt; int: ...</code>, the <code data-astro-raw="">...</code> at the end is a convention for when you provide <a href="https://mypy.readthedocs.io/en/stable/stubs.html">type stubs</a> for functions and classes, but you could technically write anything as the function body: <code data-astro-raw="">pass</code>, <code data-astro-raw="">42</code>, etc. It'll be ignored either way.</p>
</blockquote><p>Another good overload example is this:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> BinaryIO<span class="token punctuation">,</span> TextIO<span class="token punctuation">,</span> Union<span class="token punctuation">,</span> overload

<span class="token decorator annotation punctuation">@overload</span>
<span class="token keyword">def</span> <span class="token function">read_file</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">:</span> TextIO<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token decorator annotation punctuation">@overload</span>
<span class="token keyword">def</span> <span class="token function">read_file</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">:</span> BinaryIO<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">def</span> <span class="token function">read_file</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">:</span> Union<span class="token punctuation">[</span>TextIO<span class="token punctuation">,</span> BinaryIO<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'length of data is'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data</code></pre><h2 id="type-type"><code data-astro-raw="">Type</code> type</h2><p><code data-astro-raw="">Type</code> is a type used to type classes. It derives from python's way of determining the type of an object at runtime:</p><pre class="language-python"><code data-astro-raw="" class="language-python">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span>
s <span class="token operator">=</span> <span class="token string">'hello'</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token comment"># &lt;class 'int'&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token comment"># &lt;class 'int'&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">)</span>      <span class="token comment"># True</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">type</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">type</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></code></pre><blockquote>
<p>You'd usually use <code data-astro-raw="">isinstance(x, int)</code> instead of <code data-astro-raw="">type(x) == int</code> to check for behaviour, but sometimes knowing the exact type can help, for eg. in optimizations.</p>
</blockquote><p>Since <code data-astro-raw="">type(x)</code> returns the class of <code data-astro-raw="">x</code>, the type of a class <code data-astro-raw="">C</code> is <code data-astro-raw="">Type[C]</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Any<span class="token punctuation">,</span> Type

<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'C(x=</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>x<span class="token punctuation">}</span></span><span class="token string">)'</span></span>


<span class="token keyword">def</span> <span class="token function">make_object</span><span class="token punctuation">(</span>cls<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>Any<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Any<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'making object of'</span><span class="token punctuation">,</span> cls<span class="token punctuation">)</span>
    obj <span class="token operator">=</span> cls<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
    <span class="token keyword">return</span> obj


c <span class="token operator">=</span> make_object<span class="token punctuation">(</span>MyClass<span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span> <span class="token comment"># Making object of &lt;class '__main__.MyClass'&gt;</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>    <span class="token comment"># C(x=42)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>x<span class="token punctuation">)</span>  <span class="token comment"># 42</span></code></pre><blockquote>
<p>We had to use <code data-astro-raw="">Any</code> in 3 places here, and 2 of them can be eliminated by using <a href="#generics">generics</a>, and we'll talk about it later on.</p>
</blockquote><h2 id="typing-pre-existing-projects">Typing pre-existing projects</h2><p>If you need it, mypy gives you the ability to add types to your project without ever modifying the original source code. It's done using what's called "stub files".</p><p>Stub files are python-like files, that only contain <strong>type-checked variable, function, and class definitions</strong>. It's kindof like a mypy <em>header file</em>.</p><p>You can make your own type stubs by creating a <code data-astro-raw="">.pyi</code> file:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token comment">#test.py</span>

cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Fibonacci series implementation"""</span>
    <span class="token keyword">if</span> n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>

    <span class="token keyword">if</span> n <span class="token keyword">in</span> cache<span class="token punctuation">:</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>n<span class="token punctuation">]</span>

    result <span class="token operator">=</span> fibonacci<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> fibonacci<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
    cache<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> result
    <span class="token keyword">return</span> result

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>fibonacci<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Output:</span>
<span class="token comment"># 1</span>
<span class="token comment"># 1</span>
<span class="token comment"># 2</span>
<span class="token comment"># 3</span>
<span class="token comment"># 5</span>
<span class="token comment"># 8</span></code></pre><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token comment"># test.pyi</span>
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict

cache<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>Now, run mypy on the current folder (make sure you have an <code data-astro-raw="">__init__.py</code> file in the folder, if not, create an empty one).</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ <span class="token function">ls</span>
__init__.py  test.py  test.pyi

$ mypy --strict <span class="token builtin class-name">.</span>
Success: no issues found <span class="token keyword">in</span> <span class="token number">2</span> <span class="token builtin class-name">source</span> files</code></pre><h2 id="type-debugging---part-2">Type debugging - Part 2</h2><p>Since we are on the topic of projects and folders, let's discuss another one of pitfalls that you can find yourselves in when using mypy.</p><p>The first one is <a href="https://www.python.org/dev/peps/pep-0420/">PEP 420</a></p><p>A fact that took me some time to realise, was that <strong>for mypy to be able to type-check a folder, the folder must be a module</strong>.</p><p>Let's say you find yourself in this situatiion:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ tree
<span class="token builtin class-name">.</span>
‚îú‚îÄ‚îÄ test.py
‚îî‚îÄ‚îÄ utils
    ‚îî‚îÄ‚îÄ foo.py

<span class="token number">1</span> directory, <span class="token number">2</span> files

$ <span class="token function">cat</span> test.py
from utils.foo <span class="token function">import</span> average

print<span class="token punctuation">(</span>average<span class="token punctuation">(</span><span class="token number">3</span>, <span class="token number">4</span><span class="token punctuation">))</span>

$ <span class="token function">cat</span> utils/foo.py
def average<span class="token punctuation">(</span>x: int, y: int<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> float:
    <span class="token builtin class-name">return</span> float<span class="token punctuation">(</span>x + y<span class="token punctuation">)</span> / <span class="token number">2</span>

$ py test.py
<span class="token number">3.5</span>

$ mypy test.py
test.py:1: error: Cannot <span class="token function">find</span> implementation or library stub <span class="token keyword">for</span> module named <span class="token string">'utils.foo'</span>
test.py:1: note: See https://mypy.readthedocs.io/en/latest/running_mypy.html<span class="token comment">#missing-imports</span>
Found <span class="token number">1</span> error <span class="token keyword">in</span> <span class="token number">1</span> <span class="token function">file</span> <span class="token punctuation">(</span>checked <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span><span class="token punctuation">)</span></code></pre><p>What's the problem? Python is able to find <code data-astro-raw="">utils.foo</code> no problems, why can't mypy?</p><p>The error is very cryptic, but the thing to focus on is the word "module" in the error. <code data-astro-raw="">utils.foo</code> should be a module, and for that, the <code data-astro-raw="">utils</code> folder should have an <code data-astro-raw="">__init__.py</code>, even if it's empty.</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ tree
<span class="token builtin class-name">.</span>
‚îú‚îÄ‚îÄ test.py
‚îî‚îÄ‚îÄ utils
    ‚îú‚îÄ‚îÄ foo.py
    ‚îî‚îÄ‚îÄ __init__.py

<span class="token number">1</span> directory, <span class="token number">3</span> files

$ mypy test.py
Success: no issues found <span class="token keyword">in</span> <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span></code></pre><p>Now, the same issue re-appears if you're installing your package via pip, because of a completely different reason:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ tree <span class="token punctuation">..</span>
<span class="token punctuation">..</span>
‚îú‚îÄ‚îÄ setup.py
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îî‚îÄ‚îÄ mypackage
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ utils
‚îÇ           ‚îú‚îÄ‚îÄ foo.py
‚îÇ           ‚îî‚îÄ‚îÄ __init__.py
‚îî‚îÄ‚îÄ <span class="token builtin class-name">test</span>
    ‚îî‚îÄ‚îÄ test.py

<span class="token number">4</span> directories, <span class="token number">5</span> files

$ <span class="token function">cat</span> <span class="token punctuation">..</span>/setup.py
from setuptools <span class="token function">import</span> setup, find_packages

setup<span class="token punctuation">(</span>
    <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"mypackage"</span>,
    packages <span class="token operator">=</span> find_packages<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>,
    package_dir <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">""</span><span class="token builtin class-name">:</span><span class="token string">"src"</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>

$ pip <span class="token function">install</span> <span class="token punctuation">..</span>
<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
successfully installed mypackage-0.0.0

$ <span class="token function">cat</span> test.py
from mypackage.utils.foo <span class="token function">import</span> average

print<span class="token punctuation">(</span>average<span class="token punctuation">(</span><span class="token number">3</span>, <span class="token number">4</span><span class="token punctuation">))</span>

$ python test.py
<span class="token number">3.5</span>

$ mypy test.py
test.py:1: error: Cannot <span class="token function">find</span> implementation or library stub <span class="token keyword">for</span> module named <span class="token string">'mypackage.utils.foo'</span>
test.py:1: note: See https://mypy.readthedocs.io/en/latest/running_mypy.html<span class="token comment">#missing-imports</span>
Found <span class="token number">1</span> error <span class="token keyword">in</span> <span class="token number">1</span> <span class="token function">file</span> <span class="token punctuation">(</span>checked <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span><span class="token punctuation">)</span></code></pre><p>What now? Every folder has an <code data-astro-raw="">__init__.py</code>, it's even installed as a pip package and the code runs, so we know that the module structure is right. What gives?</p><p>Well, turns out that <strong>pip packages aren't type checked by mypy by default</strong>. This behaviour exists because type definitions are opt-in by default. Python packages aren't expected to be type-checked, because mypy types are completely optional. If mypy were to assume every package has type hints, it would show possibly dozens of errors because a package doesn't have proper types, or used type hints for something else, etc.</p><p>To opt-in for type checking your package, you need to add an empty <code data-astro-raw="">py.typed</code> file into your package's root directory, and also include it as metadata in your <code data-astro-raw="">setup.py</code>:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ tree <span class="token punctuation">..</span>
<span class="token punctuation">..</span>
‚îú‚îÄ‚îÄ setup.py
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îî‚îÄ‚îÄ mypackage
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ py.typed
‚îÇ       ‚îî‚îÄ‚îÄ utils
‚îÇ           ‚îú‚îÄ‚îÄ foo.py
‚îÇ           ‚îî‚îÄ‚îÄ __init__.py
‚îî‚îÄ‚îÄ <span class="token builtin class-name">test</span>
    ‚îî‚îÄ‚îÄ test.py

<span class="token number">4</span> directories, <span class="token number">6</span> files

$ <span class="token function">cat</span> <span class="token punctuation">..</span>/setup.py
from setuptools <span class="token function">import</span> setup, find_packages

setup<span class="token punctuation">(</span>
    <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"mypackage"</span>,
    packages <span class="token operator">=</span> find_packages<span class="token punctuation">(</span>
        where <span class="token operator">=</span> <span class="token string">'src'</span>,
    <span class="token punctuation">)</span>,
    package_dir <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">""</span><span class="token builtin class-name">:</span><span class="token string">"src"</span><span class="token punctuation">}</span>,
    <span class="token assign-left variable">package_data</span><span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">"mypackage"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"py.typed"</span><span class="token punctuation">]</span>,
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

$ mypy test.py
Success: no issues found <span class="token keyword">in</span> <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span></code></pre><p>There's yet another third pitfall that you might encounter sometimes, which is if <code data-astro-raw="">a.py</code> declares a class <code data-astro-raw="">MyClass</code>, and it imports stuff from a file <code data-astro-raw="">b.py</code> which requires to import <code data-astro-raw="">MyClass</code> from <code data-astro-raw="">a.py</code> for type-checking purposes.</p><p>This creates an import cycle, and Python gives you an <code data-astro-raw="">ImportError</code>. To avoid this, simple add an <code data-astro-raw="">if typing.TYPE_CHECKING:</code> block to the import statement in <code data-astro-raw="">b.py</code>, since it only needs <code data-astro-raw="">MyClass</code> for type checking. Also, everywhere you use <code data-astro-raw="">MyClass</code>, add quotes: <code data-astro-raw="">'MyClass'</code> so that Python is happy.</p><h2 id="typing-context-managers">Typing Context managers</h2><p>Context managers are a way of adding common setup and teardown logic to parts of your code, things like opening and closing database connections, establishing a websocket, and so on. On the surface it might seem simple but it's a pretty extensive topic, and if you've never heard of it before, <a href="https://www.youtube.com/watch?v=ExdtNMnP24I">Anthony covers it here</a>.</p><p>To define a context manager, you need to provide two magic methods in your class, namely <code data-astro-raw="">__enter__</code> and <code data-astro-raw="">__exit__</code>. They're then called automatically at the start and end if your <code data-astro-raw="">with</code> block.</p><p>You might have used a context manager before: <code data-astro-raw="">with open(filename) as file:</code> - this uses a context manager underneath. Speaking of which, let's write our own implementation of <code data-astro-raw="">open</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> types <span class="token keyword">import</span> TracebackType
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Any<span class="token punctuation">,</span> Optional<span class="token punctuation">,</span> IO<span class="token punctuation">,</span> Type

<span class="token keyword">class</span> <span class="token class-name">Open</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> mode<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_name <span class="token operator">=</span> filename
        self<span class="token punctuation">.</span>_mode <span class="token operator">=</span> mode

    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> IO<span class="token punctuation">[</span>Any<span class="token punctuation">]</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_mode<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_file

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>
            self<span class="token punctuation">,</span>
            exception_type<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Type<span class="token punctuation">[</span>BaseException<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            exception_instance<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>BaseException<span class="token punctuation">]</span><span class="token punctuation">,</span>
            exc_traceback<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>TracebackType<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span><span class="token builtin">bool</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>


<span class="token keyword">with</span> Open<span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> Open<span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Output: Test</span></code></pre><h2 id="typing-async-functions">Typing async functions</h2><p>The <code data-astro-raw="">typing</code> module has a duck type for all types that can be awaited: <code data-astro-raw="">Awaitable</code>.</p><p>Just like how a regular function is a <code data-astro-raw="">Callable</code>, an async function is a <code data-astro-raw="">Callable</code> that returns an <code data-astro-raw="">Awaitable</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> asyncio <span class="token keyword">import</span> Queue
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Awaitable

queue<span class="token punctuation">:</span> Queue<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">my_async_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    num <span class="token operator">=</span> <span class="token keyword">await</span> queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> num

<span class="token keyword">def</span> <span class="token function">run_async</span><span class="token punctuation">(</span>func<span class="token punctuation">:</span> Awaitable<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>func<span class="token punctuation">)</span>

reveal_type<span class="token punctuation">(</span>my_async_function<span class="token punctuation">)</span>  <span class="token comment"># Callable[[], Awaitable[int]]</span>

run_async<span class="token punctuation">(</span>my_async_function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="generics">Generics</h2><p>Generics (or generic types) is a language feature that lets you "pass types inside other types".</p><p>I personally think it is best explained with an example:</p><p>Let's say you have a function that returns the first item in an array. To define this, we need this behaviour:</p><p>"Given a list of type <code data-astro-raw="">List[X]</code>, we will be returning an item of type <code data-astro-raw="">X</code>."</p><p>And that's exactly what generic types are: <strong>defining your return type based on the input type</strong>.</p><h3 id="generic-functions">Generic functions</h3><p>We've seen <code data-astro-raw="">make_object</code> from the <a href="#type-type">Type type</a> section before, but we had to use <code data-astro-raw="">Any</code> to be able to support returning any kind of object that got created by calling <code data-astro-raw="">cls(*args)</code>. But, we don't actually have to do that, because we can use generics. Here's how you'd do that:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Any<span class="token punctuation">,</span> Type<span class="token punctuation">,</span> TypeVar

<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'C(x=</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>x<span class="token punctuation">}</span></span><span class="token string">)'</span></span>

T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">make_object</span><span class="token punctuation">(</span>cls<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> T<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'making object of'</span><span class="token punctuation">,</span> cls<span class="token punctuation">)</span>
    obj <span class="token operator">=</span> cls<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
    <span class="token keyword">return</span> obj


c <span class="token operator">=</span> make_object<span class="token punctuation">(</span>MyClass<span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span> <span class="token comment"># Making object of &lt;class '__main__.MyClass'&gt;</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>        <span class="token comment"># C(x=42)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>x<span class="token punctuation">)</span>      <span class="token comment"># 42</span>

reveal_type<span class="token punctuation">(</span>c<span class="token punctuation">)</span>  <span class="token comment"># Revealed type is 'test.MyClass'</span></code></pre><p><code data-astro-raw="">T = TypeVar('T')</code> is how you declare a generic type in Python. What the function definition now says, is "If i give you a class that makes <code data-astro-raw="">T</code>'s, you'll be returning an object <code data-astro-raw="">T</code>".</p><p>And sure enough, the <code data-astro-raw="">reveal_type</code> on the bottom shows that mypy knows <code data-astro-raw="">c</code> is an object of <code data-astro-raw="">MyClass</code>.</p><blockquote>
<p>The generic type name <code data-astro-raw="">T</code> is another convention, you can call it anything.</p>
</blockquote><p>Another example: <code data-astro-raw="">largest</code>, which returns the largest item in a list:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Sequence<span class="token punctuation">,</span> TypeVar

T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">largest</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> Sequence<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> T<span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Cannot get largest item in empty list"</span><span class="token punctuation">)</span>

    largest_item <span class="token operator">=</span> items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
        <span class="token keyword">if</span> item <span class="token operator">&gt;</span> largest_item<span class="token punctuation">:</span>
            largest_item <span class="token operator">=</span> item

    <span class="token keyword">return</span> largest_item

nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>largest<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Output: 42</span></code></pre><p>This seems good, but mypy isn't happy:</p><pre class="language-bash"><code data-astro-raw="" class="language-bash">$ mypy --strict test.py
test.py:10: error: Unsupported left operand <span class="token builtin class-name">type</span> <span class="token keyword">for</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token string">"T"</span><span class="token punctuation">)</span>
Found <span class="token number">1</span> error <span class="token keyword">in</span> <span class="token number">1</span> <span class="token function">file</span> <span class="token punctuation">(</span>checked <span class="token number">1</span> <span class="token builtin class-name">source</span> <span class="token function">file</span><span class="token punctuation">)</span></code></pre><p>This is because you need to ensure you can do <code data-astro-raw="">a &lt; b</code> on the objects, to compare them with each other, which isn't always the case:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">&lt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;stdin&gt;"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
TypeError<span class="token punctuation">:</span> <span class="token string">'&lt;'</span> <span class="token keyword">not</span> supported between instances of <span class="token string">'dict'</span> <span class="token keyword">and</span> <span class="token string">'dict'</span></code></pre><p>For this, we need a <a href="#duck-types">Duck Type</a> that defines this "a less than b" behaviour.</p><p>And although currently Python doesn't have one such builtin hankfully, there's a "virtual module" that ships with mypy called <code data-astro-raw="">_typeshed</code>. It has a lot of extra duck types, along with other mypy-specific features.</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Sequence<span class="token punctuation">,</span> TypeVar<span class="token punctuation">,</span> TYPE_CHECKING

<span class="token keyword">if</span> TYPE_CHECKING<span class="token punctuation">:</span>
    <span class="token keyword">from</span> _typeshed <span class="token keyword">import</span> SupportsLessThan

T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">,</span> bound<span class="token operator">=</span><span class="token string">'SupportsLessThan'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">largest</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> Sequence<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> T<span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Cannot get largest item in empty list"</span><span class="token punctuation">)</span>

    largest_item <span class="token operator">=</span> items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
        <span class="token keyword">if</span> item <span class="token operator">&gt;</span> largest_item<span class="token punctuation">:</span>
            largest_item <span class="token operator">=</span> item

    <span class="token keyword">return</span> largest_item

nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>largest<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Output: 42</span></code></pre><p>Now, mypy will only allow passing lists of objects to this function that can be compared to each other.</p><blockquote>
<p>If you're wondering why checking for <code data-astro-raw="">&lt;</code> was enough while our code uses <code data-astro-raw="">&gt;</code>, <a href="https://docs.python.org/3/reference/datamodel.html#object.**lt**">that's how python does comparisons</a>. I'm planning to write an article on this later.</p>
</blockquote><p>Note that <code data-astro-raw="">_typeshed</code> is <strong>not an actual module</strong> in Python, so you'll have to import it by checking <code data-astro-raw="">if TYPE_CHECKING</code> to ensure python doesn't give a <code data-astro-raw="">ModuleNotFoundError</code>. And since <code data-astro-raw="">SupportsLessThan</code> won't be defined when Python runs, we had to use it as a string when passed to <code data-astro-raw="">TypeVar</code>.</p><blockquote>
<p>At this point you might be interested in how you could implement one of your own such <code data-astro-raw="">SupportsX</code> types. For that, we have another section below: <a href="#protocol">Protocols</a>.</p>
</blockquote><h3 id="generic-classes">Generic classes</h3><p>we implemented a simple Stack class in <a href="#typing-classes">typing classes</a>, but it only worked for integers. But we can very simply make it work for any type.</p><p>To do that, we need mypy to understand what <code data-astro-raw="">T</code> means inside the class. And for that, we need the class to extend <code data-astro-raw="">Generic[T]</code>, and then provide the concrete type to <code data-astro-raw="">Stack</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Generic<span class="token punctuation">,</span> TypeVar

T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_values<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'Stack</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>_values<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">'</span></span>

    <span class="token keyword">def</span> <span class="token function">push</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_values<span class="token punctuation">.</span>append<span class="token punctuation">(</span>value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">pop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_values<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">'Underflow!'</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_values<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>

stack <span class="token operator">=</span> Stack<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span>        <span class="token comment"># Stack[]</span>

stack<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
stack<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span>        <span class="token comment"># Stack[2, 10]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 10</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span>        <span class="token comment"># Stack[2]</span></code></pre><p>You can pass as many <code data-astro-raw="">TypeVar</code>s to <code data-astro-raw="">Generic[...]</code> as you need, for eg. to make a generic dictionary, you might use <code data-astro-raw="">class Dict(Generic[KT, VT]): ...</code></p><h3 id="generic-types">Generic types</h3><p>Generic types (a.k.a. <strong>Type Aliases</strong>) allow you to put a commonly used type in a variable -- and then use that variable as if it were that type.</p><p>And mypy lets us do that very easily: with literally just an assignment. The generics parts of the type are automatically inferred.</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> TypeVar<span class="token punctuation">,</span> Union

T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
MyOptional <span class="token operator">=</span> Union<span class="token punctuation">[</span>T<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">get_unicorn</span><span class="token punctuation">(</span>d<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> MyOptional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> d<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'unicorn'</span><span class="token punctuation">)</span>

d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span>
unicorn <span class="token operator">=</span> get_unicorn<span class="token punctuation">(</span>d<span class="token punctuation">)</span>

reveal_type<span class="token punctuation">(</span>unicorn<span class="token punctuation">)</span>  <span class="token comment"># Union[int, None]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>unicorn<span class="token punctuation">)</span>        <span class="token comment"># None</span></code></pre><blockquote>
<p>There is an upcoming syntax that makes it clearer that we're defining a type alias: <code data-astro-raw="">Vector: TypeAlias = Tuple[int, int]</code>. This is available starting Python 3.10</p>
</blockquote><p>Just like how we were able to tell the TypeVar <code data-astro-raw="">T</code> before to only support types that <code data-astro-raw="">SupportLessThan</code>, we can also do that</p><p><code data-astro-raw="">AnyStr</code> is a builtin <a href="https://mypy.readthedocs.io/en/stable/generics.html?highlight=anystr#type-variables-with-value-restriction">restricted TypeVar</a>, used to define a unifying type for functions that accept <code data-astro-raw="">str</code> and <code data-astro-raw="">bytes</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar

AnyStr <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'AnyStr'</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">concat</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> AnyStr<span class="token punctuation">,</span> y<span class="token punctuation">:</span> AnyStr<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> AnyStr<span class="token punctuation">:</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y

concat<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span>             <span class="token comment"># Ok</span>
concat<span class="token punctuation">(</span><span class="token string">b'a'</span><span class="token punctuation">,</span> <span class="token string">b'b'</span><span class="token punctuation">)</span>           <span class="token comment"># Ok</span>
concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>                 <span class="token comment"># Error</span>
concat<span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token string">b'bytes'</span><span class="token punctuation">)</span>   <span class="token comment"># Error - different object types: str and bytes</span></code></pre><p>This is different from <code data-astro-raw="">Union[str, bytes]</code>, because <code data-astro-raw="">AnyStr</code> represents <strong>Any one of those two types at a time</strong>, and thus doesn't <code data-astro-raw="">concat</code> doesn't accept the first arg as <code data-astro-raw="">str</code> and the second as <code data-astro-raw="">bytes</code>.</p><h2 id="advancedrecursive-type-checking-with-protocol">Advanced/Recursive type checking with <code data-astro-raw="">Protocol</code></h2><p>We implemented <code data-astro-raw="">FakeFuncs</code> in the <a href="#duck-types">duck types</a> section above, and we used <code data-astro-raw="">isinstance(FakeFuncs, Callable)</code> to verify that the object indeed, was recognized as a callable.</p><p>But what if we need to duck-type methods other than <code data-astro-raw="">__call__</code>?</p><p>If we want to do that with an entire class: That becomes harder. Say we want a "duck-typed class", that "has a get method that returns an int", and so on. We don't actually have access to the actual class for some reason, like maybe we're writing helper functions for an API library.</p><p>To do that, we need to define a <code data-astro-raw="">Protocol</code>:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token comment"># api_library.py</span>

<span class="token keyword">class</span> <span class="token class-name">Api</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> endpoint<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
        status_code <span class="token operator">=</span> <span class="token number">404</span>
        <span class="token keyword">return</span> status_code
        <span class="token comment"># TODO: implement an actual API</span>

    <span class="token keyword">def</span> <span class="token function">is_connected</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span></code></pre><p>Using this, we were able to type check out code, without ever needing a completed <code data-astro-raw="">Api</code> implementaton.</p><p>This is <em>extremely powerful</em>. We're essentially defining the <em>structure</em> of object we need, instead of what class it is from, or it inherits from. This gives us the flexibility of duck typing, but on the scale of an entire class.</p><p>Remember <code data-astro-raw="">SupportsLessThan</code>? if you check its implementation in <code data-astro-raw="">_typeshed</code>, this is it:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Protocol

<span class="token keyword">class</span> <span class="token class-name">SupportsLessThan</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__lt__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> __other<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>Yeah, that's the entire implementaton.</p><p>What this also allows us to do is define <strong>Recursive type definitions</strong>. The simplest example would be a Tree:</p><pre class="language-python"><code data-astro-raw="" class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Generator<span class="token punctuation">,</span> Optional<span class="token punctuation">,</span> Protocol

<span class="token keyword">class</span> <span class="token class-name">_Tree</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
            self<span class="token punctuation">,</span>
            data<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
            left<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token string">'_Tree'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
            right<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token string">'_Tree'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span>_Tree<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
            self<span class="token punctuation">,</span>
            data<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
            left<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token string">'Tree'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
            right<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token string">'Tree'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data
        self<span class="token punctuation">.</span>left <span class="token operator">=</span> left
        self<span class="token punctuation">.</span>right <span class="token operator">=</span> right

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'Tree(</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>data<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">)'</span></span>


tree <span class="token operator">=</span> Tree<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> left<span class="token operator">=</span>Tree<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> right<span class="token operator">=</span>Tree<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span>       <span class="token comment"># Tree(2)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>left<span class="token punctuation">)</span>  <span class="token comment"># Tree(4)</span>

<span class="token keyword">def</span> <span class="token function">traverse_inorder</span><span class="token punctuation">(</span>tree<span class="token punctuation">:</span> Tree<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Generator<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> tree<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token keyword">from</span> traverse_inorder<span class="token punctuation">(</span>tree<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> tree<span class="token punctuation">.</span>data
    <span class="token keyword">if</span> tree<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token keyword">from</span> traverse_inorder<span class="token punctuation">(</span>tree<span class="token punctuation">.</span>right<span class="token punctuation">)</span>

<span class="token keyword">for</span> value <span class="token keyword">in</span> traverse_inorder<span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>

<span class="token comment"># Output:</span>
<span class="token comment"># 4</span>
<span class="token comment"># 2</span>
<span class="token comment"># 0</span></code></pre><blockquote>
<p><em>Note that for this simple example, using Protocol wasn't necessary, as mypy is able to understand simple recursive structures. But for anything more complex than this, like an N-ary tree, you'll need to use Protocol.</em>
Structural subtyping and all of its features are defined extremely well in <a href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a>.</p>
</blockquote><h2 id="further-learning">Further learning</h2><p>If you're interested in reading even more about types, mypy has excellent <a href="https://mypy.readthedocs.io/en/stable">documentation</a>, and you should definitely read it for further learning, especially the section on <a href="https://mypy.readthedocs.io/en/stable/generics.html">Generics</a>.</p><p>I referenced a lot of <a href="https://github.com/asottile">Anthony Sottile's</a> videos in this for topics out of reach of this article. He has a <a href="https://www.youtube.com/channel/UC46xhU1EH7aywEgvA9syS3w">YouTube channel</a> where he posts short, and very informative videos about Python.</p><p>You can find the source code the typing module <a href="https://github.com/python/cpython/blob/main/Lib/typing.py">here</a>, of all the typing duck types inside the <a href="https://github.com/python/cpython/blob/main/Lib/_collections_abc.py">_collections_abc module</a>, and of the extra ones in <code data-astro-raw="">_typeshed</code> in the <a href="https://github.com/python/typeshed/blob/master/stdlib/_typeshed/**init**.pyi">typeshed repo</a>.</p><p>A topic that I skipped over while talking about <code data-astro-raw="">TypeVar</code> and generics, is <em>Variance</em>. It's a topic in type theory that defines how subtypes and generics relate to each other. If you want to learn about it in depth, there's documentation in <a href="https://mypy.readthedocs.io/en/stable/generics.html#variance-of-generic-types">mypy docs</a> of course, and there's two more blogs I found which help grasp the concept, <a href="https://blog.daftcode.pl/covariance-contravariance-and-invariance-the-ultimate-python-guide-8fabc0c24278">here</a> and <a href="https://blog.magrathealabs.com/pythons-covariance-and-contravariance-b422c63f57ac">here</a>.</p><p>A bunch of this material was cross-checked using <a href="https://docs.python.org/3">Python's official documentation</a>, and honestly their docs are always great. Also, the "Quick search" feature works surprisingly well.</p><p>There's also quite a few typing PEPs you can read, starting with the kingpin: <a href="https://www.python.org/dev/peps/pep-0484/">PEP 484</a>, and the accompanying <a href="https://www.python.org/dev/peps/pep-0526/">PEP 526</a>. Other PEPs I've mentioned in the article above are <a href="https://www.python.org/dev/peps/pep-0585/">PEP 585</a>, <a href="https://www.python.org/dev/peps/pep-0563/">PEP 563</a>, <a href="https://www.python.org/dev/peps/pep-0420/">PEP 420</a> and <a href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a>.</p><hr><p>And that's it!</p><p>I've worked pretty hard on this article, distilling down everything I've learned about mypy in the past year, into a single source of knowledge. If you have any doubts, thoughts, or suggestions, be sure to comment below and I'll get back to you.</p><p>Also, if you read the whole article till here, Thank you! And congratulations, you now know almost everything you'll need to be able to write fully typed Python code in the future. I hope you liked it ‚ú®</p>
    </main>
  </article>
</div>



    <hr class="astro-7CIAHWF2">
    <div class="centered astro-7CIAHWF2">
      <astro-root uid="ZwUM0Q"></astro-root>
    </div>
    <div class="back-to-top-wrapper astro-7CIAHWF2">
      <a href="#top" class="back-to-top-link astro-7CIAHWF2" aria-label="Scroll to Top">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-chevron-up astro-7CIAHWF2" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z" class="astro-7CIAHWF2"></path>
        </svg>
      </a>
    </div>
    <script src="https://utteranc.es/client.js" repo="tusharsadhwani/blog-comments" issue-term="title" theme="dark-blue" crossorigin="anonymous" async="">
    </script>
  
  <hr class="astro-ZUKZCZIV">
<footer class="astro-ZUKZCZIV">
  <a href="https://twitter.com/sadhlife" class="astro-ZUKZCZIV">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="astro-ZUKZCZIV"><path fill="currentColor" d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z" class="astro-ZUKZCZIV"></path></svg>
    <p class="astro-ZUKZCZIV">Follow for Python tips</p>
  </a>
  <a href="https://discord.gg/XjAQ53YbpE" class="astro-ZUKZCZIV">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="astro-ZUKZCZIV"><path fill="currentColor" d="M20.222 0c1.406 0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402 0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222 0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475 0h-.2c-.47 0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02 0 0 1 1.74 3.743 1.806 0 0 .4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03 0 .044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21 0 .6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737 0 0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726 0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703 0 1.27.6 1.27 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334.002-.74.573-1.338 1.27-1.338zm-4.543 0c.7 0 1.266.6 1.266 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334 0-.74.57-1.338 1.27-1.338z" class="astro-ZUKZCZIV"></path></svg>
    <p class="astro-ZUKZCZIV">Join the community</p>
  </a>
  <a href="https://github.com/tusharsadhwani/blog" class="astro-ZUKZCZIV">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="astro-ZUKZCZIV"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" class="astro-ZUKZCZIV"></path></svg>
    <p class="astro-ZUKZCZIV">Check source code</p>
  </a>
  <a href="https://tusharsadhwani.dev" class="astro-ZUKZCZIV">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="astro-ZUKZCZIV"><path fill="currentColor" d="M14.31.18l.9.2.73.26.59.3.45.32.34.34.25.34.16.33.1.3.04.26.02.2-.01.13V8.5l-.05.63-.13.55-.21.46-.26.38-.3.31-.33.25-.35.19-.35.14-.33.1-.3.07-.26.04-.21.02H8.83l-.69.05-.59.14-.5.22-.41.27-.33.32-.27.35-.2.36-.15.37-.1.35-.07.32-.04.27-.02.21v3.06H3.23l-.21-.03-.28-.07-.32-.12-.35-.18-.36-.26-.36-.36-.35-.46-.32-.59-.28-.73-.21-.88-.14-1.05L0 11.97l.06-1.22.16-1.04.24-.87.32-.71.36-.57.4-.44.42-.33.42-.24.4-.16.36-.1.32-.05.24-.01h.16l.06.01h8.16v-.83H6.24l-.01-2.75-.02-.37.05-.34.11-.31.17-.28.25-.26.31-.23.38-.2.44-.18.51-.15.58-.12.64-.1.71-.06.77-.04.84-.02 1.27.05 1.07.13zm-6.3 1.98l-.23.33-.08.41.08.41.23.34.33.22.41.09.41-.09.33-.22.23-.34.08-.41-.08-.41-.23-.33-.33-.22-.41-.09-.41.09-.33.22zM21.1 6.11l.28.06.32.12.35.18.36.27.36.35.35.47.32.59.28.73.21.88.14 1.04.05 1.23-.06 1.23-.16 1.04-.24.86-.32.71-.36.57-.4.45-.42.33-.42.24-.4.16-.36.09-.32.05-.24.02-.16-.01h-8.22v.82h5.84l.01 2.76.02.36-.05.34-.11.31-.17.29-.25.25-.31.24-.38.2-.44.17-.51.15-.58.13-.64.09-.71.07-.77.04-.84.01-1.27-.04-1.07-.14-.9-.2-.73-.25-.59-.3-.45-.33-.34-.34-.25-.34-.16-.33-.1-.3-.04-.25-.02-.2.01-.13v-5.34l.05-.64.13-.54.21-.46.26-.38.3-.32.33-.24.35-.2.35-.14.33-.1.3-.06.26-.04.21-.02.13-.01h5.84l.69-.05.59-.14.5-.21.41-.28.33-.32.27-.35.2-.36.15-.36.1-.35.07-.32.04-.28.02-.21V6.07h2.09l.14.01.21.03zm-6.47 14.25l-.23.33-.08.41.08.41.23.33.33.23.41.08.41-.08.33-.23.23-.33.08-.41-.08-.41-.23-.33-.33-.23-.41-.08-.41.08-.33.23z" class="astro-ZUKZCZIV"></path></svg>
    <p class="astro-ZUKZCZIV">View the main site</p>
  </a>
</footer>


  <noscript>
    <img src="https://analytics.sadh.life/ingress/f6c6e99f-df6a-43f3-9c16-f434cee0278e/pixel.gif">
  </noscript>
  <script defer="" src="https://analytics.sadh.life/ingress/f6c6e99f-df6a-43f3-9c16-f434cee0278e/script.js"></script>

</body></html>